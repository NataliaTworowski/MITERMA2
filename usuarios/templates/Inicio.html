
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <title>{{ title }}</title>
    {% include 'partials/head.html' %}
</head>
<body class="flex min-h-screen bg-gray-100">

    <!--  navbar de usuario -->
    {% include 'partials/navbar_usuario.html' %}

    <!-- Mensaje de bienvenida -->
    {% if messages %}
        <div class="fixed top-20 right-4 z-50 space-y-2">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} p-4 rounded-lg shadow-lg max-w-sm 
                    {% if message.tags == 'success' %}bg-green-100 border border-green-400 text-green-700
                    {% elif message.tags == 'error' %}bg-red-100 border border-red-400 text-red-700
                    {% elif message.tags == 'warning' %}bg-yellow-100 border border-yellow-400 text-yellow-700
                    {% else %}bg-blue-100 border border-blue-400 text-blue-700{% endif %}"
                    role="alert">
                    <div class="flex items-center justify-between">
                        <span>{{ message }}</span>
                        <button type="button" class="ml-2 text-gray-500 hover:text-gray-700" onclick="this.parentElement.parentElement.remove()">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <main class="flex-1 md:ml-0 p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Barra de búsqueda -->
            <div class="bg-white rounded-lg shadow-sm p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Buscar Termas</h2>
                
                <form method="GET" action="{% url 'termas:buscar' %}" class="space-y-4">
                    <!-- Busqueda por texto -->
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <input 
                            type="text" 
                            name="busqueda" 
                            placeholder="Buscar por nombre o descripción..." 
                            class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg"
                            value="{{ busqueda }}"
                        >
                    </div>
                    
                    <!-- Selectores de región y comunas -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Selector de Región -->
                        <div>
                            <label for="region" class="block text-sm font-medium text-gray-700 mb-2">Región</label>
                            <select name="region" id="region" class="block w-full py-3 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-base">
                                <option value="">Todas las regiones</option>
                                {% for region in regiones %}
                                    <option value="{{ region.id }}" {% if region.id|stringformat:"s" == region_seleccionada %}selected{% endif %}>
                                        {{ region.nombre }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Selector de comunas -->
                        <div>
                            <label for="comuna" class="block text-sm font-medium text-gray-700 mb-2">Comuna</label>
                            <select name="comuna" id="comuna" class="block w-full py-3 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-base">
                                <option value="">Todas las comunas</option>
                                {% for comuna in comunas %}
                                    <option value="{{ comuna.id }}" data-region="{{ comuna.region.id }}" {% if comuna.id|stringformat:"s" == comuna_seleccionada %}selected{% endif %}>
                                        {{ comuna.nombre }} ({{ comuna.region.nombre }})
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-center space-x-4">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors duration-200">
                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                            </svg>
                            Buscar Termas
                        </button>
                    </div>
                </form>
            </div>

            <!-- Resultados de busqueda -->
            {% if busqueda or region_seleccionada or comuna_seleccionada or termas %}
                <div class="mt-8 bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">
                        {% if busqueda %}
                            Resultados para "{{ busqueda }}" ({{ total_resultados }} encontrado{{ total_resultados|pluralize }})
                        {% elif region_seleccionada or comuna_seleccionada %}
                            Resultados de búsqueda ({{ total_resultados }} encontrado{{ total_resultados|pluralize }})
                        {% else %}
                            Todas las termas disponibles ({{ total_resultados }} encontrado{{ total_resultados|pluralize }})
                        {% endif %}
                    </h3>
                    
                    {% if termas %}
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {% for terma in termas %}
                                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-2">{{ terma.nombre_terma }}</h4>
                                    
                                    <div class="text-sm text-gray-600 mb-2">
                                        <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                        </svg>
                                        {% if terma.comuna %}
                                            {{ terma.comuna.nombre }}, {{ terma.comuna.region.nombre }}
                                        {% else %}
                                            Ubicación no especificada
                                        {% endif %}
                                    </div>
                                    
                                    {% if terma.descripcion_terma %}
                                        <p class="text-gray-600 text-sm mb-3 line-clamp-3">{{ terma.descripcion_terma|truncatewords:20 }}</p>
                                    {% endif %}
                                    
                                    {% if terma.calificacion_promedio %}
                                        <div class="flex items-center mb-3">
                                            <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <span class="text-sm text-gray-600">{{ terma.calificacion_promedio|floatformat:1 }}/5 ({{ terma.total_calificaciones }} reseña{{ terma.total_calificaciones|pluralize }})</span>
                                        </div>
                                    {% else %}
                                        <div class="flex items-center mb-3">
                                            <svg class="w-4 h-4 text-gray-300 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <span class="text-sm text-gray-400">Sin calificaciones</span>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8">
                            <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-3-8.5c-3.5 0-7 2.5-7 7.5 0 5.5 4.5 9 9 9s9-3.5 9-9c0-5-3.5-7.5-7-7.5z"></path>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No se encontraron termas</h3>
                            <p class="text-gray-500">Intenta con otros términos de búsqueda.</p>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Script para funcionalidad de búsqueda -->
    <script src="{% static 'usuarios/js/busqueda_termas.js' %}"></script>

</body>
</html>

    