
{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
    <title>{{ title }}</title>
    {% include 'partials/head.html' %}
</head>
<body class="flex min-h-screen bg-[#f8fafc]">
    <!-- Sidebar -->
    <aside class="fixed left-0 top-0 h-screen w-64 bg-[#0F202A] text-white py-6 px-4 flex flex-col">
        <div class="flex items-center gap-3 mb-8">
            <img src="{% static 'img/logo.png' %}" alt="MiTerma Logo" class="w-10 h-10">
            <span class="text-xl font-semibold">MiTerma</span>
        </div>

        <!-- Usuario -->
        <div class="flex items-center gap-3 mb-8 p-3 bg-[#1a2f3a] rounded-lg">
            <div class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center text-[#0F202A] font-bold">
                {{ usuario.nombre|first }}
            </div>
            <div>
                <p class="font-medium">{{ usuario.nombre }}</p>
                <p class="text-sm text-gray-400">Cliente</p>
            </div>
        </div>

        <!-- Menú -->
        <nav class="flex-1 flex flex-col space-y-2">
            <a href="{% url 'usuarios:inicio' %}" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Inicio -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                <span>Inicio</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Termas -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 21h4m4 0h-4m0 0V3m0 18a4 4 0 01-4-4V7a4 4 0 018 0v10a4 4 0 01-4 4z" />
                </svg>
                <span>Termas</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Reseñas -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 11V7a4 4 0 018 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                <span>Mis Reseñas</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Reservas -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10m-10 4h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>Mis Reservas</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Favoritos -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
                <span>Favoritos</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Notificaciones -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                <span>Notificaciones</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Mensajes -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h6m-6 4h8M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>Mensajes</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Métodos de pago -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="2" y="7" width="20" height="10" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 11h20" />
                </svg>
                <span>Metodos de pago</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                <!-- Icono Ayuda y soporte -->
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 14v.01M12 10v.01M16 10h.01M21 12c0 4.418-4.03 8-9 8s-9-3.582-9-8a9 9 0 1118 0z" />
                </svg>
                <span>Ayuda y soporte</span>
            </a>
            
            <!-- Espaciador que empuja el botón de cerrar sesión hacia abajo -->
            <div class="flex-1"></div>

            <!-- Botón de cerrar sesión -->
            <form action="{% url 'usuarios:logout' %}" method="POST" class="mt-auto">
                {% csrf_token %}
                <button type="submit" class="flex w-full items-center gap-3 p-3 rounded-lg hover:bg-red-600 transition-colors text-red-500 hover:text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span>Cerrar Sesión</span>
                </button>
            </form>
        </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="flex-1 ml-64 p-8">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-2xl font-bold text-gray-900">Buscar Termas</h1>
                <p class="text-sm text-gray-600">Descubre las mejores experiencias termales de Chile</p>
            </div>

            <!-- Mensajes -->
            {% if messages %}
                <div class="fixed top-4 right-4 z-50 space-y-2">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} p-4 rounded-lg shadow-lg max-w-sm 
                            {% if message.tags == 'success' %}bg-green-100 border border-green-400 text-green-700
                            {% elif message.tags == 'error' %}bg-red-100 border border-red-400 text-red-700
                            {% elif message.tags == 'warning' %}bg-yellow-100 border border-yellow-400 text-yellow-700
                            {% else %}bg-blue-100 border border-blue-400 text-blue-700{% endif %}"
                            role="alert">
                            <div class="flex items-center justify-between">
                                <span>{{ message }}</span>
                                <button type="button" class="ml-2 text-gray-500 hover:text-gray-700" onclick="this.parentElement.parentElement.remove()">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Filtros de búsqueda -->
            <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
                <h2 class="text-lg font-semibold mb-4">Filtros de Búsqueda</h2>
                <form method="get" action="" class="space-y-4" id="formBusquedaTermas">
                    <!-- Barra de búsqueda -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Buscar por nombre o descripción</label>
                        <div class="relative">
                            <input type="text" id="searchInput" name="busqueda" placeholder="Buscar por nombre o descripción..." 
                                value="{{ busqueda }}"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <svg class="absolute right-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>

                    <!-- Filtros de región y comuna -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="region" class="block text-sm font-medium text-gray-700 mb-1">Región</label>
                            <select id="region" name="region" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Todas las regiones</option>
                                {% for region in regiones %}
                                    <option value="{{ region.id }}" {% if region_seleccionada == region.id|stringformat:'s' %}selected{% endif %}>{{ region.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="comuna" class="block text-sm font-medium text-gray-700 mb-1">Comuna</label>
                            <select id="comuna" name="comuna" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Todas las comunas</option>
                                {% for comuna in comunas %}
                                    <option value="{{ comuna.id }}" data-region="{{ comuna.region.id }}" {% if comuna_seleccionada == comuna.id|stringformat:'s' %}selected{% endif %}>{{ comuna.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="flex justify-between items-center">
                        <button id="buscarTermas" type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Buscar Termas
                        </button>
                        <button id="limpiarFiltros" type="button" class="text-gray-600 hover:text-gray-800 transition-colors">
                            Limpiar filtros
                        </button>
                    </div>
                </form>
            </div>

            <!-- Resultados de búsqueda o termas destacadas -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-6">
                    {% if busqueda or region_seleccionada or comuna_seleccionada %}
                        <h2 class="text-xl font-bold text-gray-900">Resultados de búsqueda</h2>
                        <span class="text-sm text-gray-600">{{ total_resultados }} resultados encontrados</span>
                    {% else %}
                        <h2 class="text-xl font-bold text-gray-900">Termas Destacadas</h2>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600">Ordenar por:</span>
                            <select id="ordenarPor" class="text-sm border-none bg-transparent focus:ring-0">
                                <option value="populares">Más populares</option>
                                <option value="recientes">Más recientes</option>
                                <option value="precio">Mejor precio</option>
                            </select>
                        </div>
                    {% endif %}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    {% if termas_destacadas %}
                        {% for terma in termas_destacadas %}
                        <div class="bg-white rounded-2xl shadow-sm overflow-hidden group">
                            <div class="relative">
                                {% if terma.imagenes.all %}
                                    <img src="{{ terma.imagenes.first.url_imagen }}" alt="{{ terma.nombre_terma }}" class="w-full h-48 object-cover">
                                {% else %}
                                    <img src="{% static 'img/terma_default.png' %}" alt="Imagen por defecto" class="w-full h-48 object-cover">
                                {% endif %}
                                <button class="absolute top-3 right-3 p-2 rounded-full bg-white/80 hover:bg-white transition-colors">
                                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="p-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span class="text-sm text-gray-600">{% if terma.comuna %}{{ terma.comuna.nombre }}{% endif %}{% if terma.comuna and terma.comuna.region %}, {{ terma.comuna.region.nombre }}{% endif %}</span>
                                </div>
                                <h3 class="text-lg font-semibold mb-2">{{ terma.nombre_terma }}</h3>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center">
                                        <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-gray-700 ml-1">{% if terma.calificacion_promedio %}{{ terma.calificacion_promedio|floatformat:1 }}{% else %}N/A{% endif %}</span>
                                        <span class="text-sm text-gray-500 ml-1">({{ terma.total_calificaciones }})</span>
                                    </div>
                                    <span class="text-xs text-gray-500">•</span>
                                    <span class="text-sm text-gray-600">{% if terma.temperatura %}{{ terma.temperatura }}°C{% else %}--°C{% endif %}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div>
                                        <span class="text-sm text-gray-500">Desde</span>
                                        <p class="text-lg font-bold text-gray-900">${% if terma.precio_minimo %}{{ terma.precio_minimo|floatformat:0 }}{% else %}--{% endif %}</p>
                                    </div>
                                    <a href="{% url 'termas:detalle' terma.id %}" class="bg-[#0F202A] text-white px-4 py-2 rounded-lg hover:bg-[#1a2f3a] transition-colors">
                                        Ver más
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="col-span-4 text-center text-gray-500 py-12">
                            No se encontraron termas para los filtros seleccionados.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>

    <!-- Script para funcionalidad de búsqueda -->
    <script src="{% static 'usuarios/js/busqueda_termas.js' %}"></script>

</body>
</html>

    